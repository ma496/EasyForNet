namespace EasyBiz.Tests.Features.{{featureName}}.Endpoints.{{entitiesName}};

using EasyBiz.Features.{{featureName}}.Core;
using EasyBiz.Features.{{featureName}}.Endpoints.{{entitiesName}};

public class {{entityName}}CreateTests(App app, ITestOutputHelper output) : AppTestsBase(app)
{
    [Fact]
    public async Task Create_{{entityName}}_With_Valid_Input_Returns_Created()
    {
        await SetAuthTokenAsync();

        // Before writing this test, read the {{entityName}}Configuration.cs file to identify which properties have a unique index.
        var request = new Faker<{{entityName}}CreateRequest>()
            .RuleFor(u => u.Name, f => f.Commerce.ProductName() + f.UniqueIndex)
            .Generate();

        var (rsp, res) = await App.Client.POSTAsync<{{entityName}}CreateEndpoint, {{entityName}}CreateRequest, {{entityName}}CreateResponse>(request);

        if (rsp.StatusCode != HttpStatusCode.Created)
        {
            output.WriteLine(await rsp.Content.ReadAsStringAsync());
        }

        rsp.StatusCode.Should().Be(HttpStatusCode.Created);
        res.Should().NotBeNull();

        var dbContext = App.Services.GetRequiredService<AppDbContext>();
        var saved{{entityName}} = await dbContext.{{entitiesName}}.FirstOrDefaultAsync(p => p.Id == res.Id);
        saved{{entityName}}.Should().NotBeNull();
        saved{{entityName}}!.Name.Should().Be(request.Name);
    }
}