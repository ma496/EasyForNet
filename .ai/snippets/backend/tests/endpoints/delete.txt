namespace EasyBiz.Tests.Features.{{featureName}}.Endpoints.{{entitiesName}};

using EasyBiz.Features.{{featureName}}.Endpoints.{{entitiesName}};

public class {{entityName}}DeleteTests(App app, ITestOutputHelper output) : AppTestsBase(app)
{
    [Fact]
    public async Task Delete_{{entityName}}()
    {
        await SetAuthTokenAsync();

        // Create a new entity first
        // Before writing this test, read the {{entityName}}Configuration.cs file to identify which properties have a unique index.
        var request = new Faker<{{entityName}}CreateRequest>()
            .RuleFor(u => u.Name, f => f.Company.CompanyName() + f.UniqueIndex)
            .Generate();=> u.Description, f => f.Commerce.ProductDescription())
            .Generate();

        var (createRsp, createRes) = await App.Client.POSTAsync<{{entityName}}CreateEndpoint, {{entityName}}CreateRequest, {{entityName}}CreateResponse>(request);

        if (createRsp.StatusCode != HttpStatusCode.Created)
        {
            output.WriteLine(await createRsp.Content.ReadAsStringAsync());
        }

        createRsp.StatusCode.Should().Be(HttpStatusCode.Created);

        // Then delete the entity
        var deleteRsp = await App.Client.DELETEAsync<{{entityName}}DeleteEndpoint, {{entityName}}DeleteRequest>(
            new()
            {
                Id = createRes.Id
            });

        if (deleteRsp.StatusCode != HttpStatusCode.NoContent)
        {
            output.WriteLine(await deleteRsp.Content.ReadAsStringAsync());
        }

        deleteRsp.StatusCode.Should().Be(HttpStatusCode.NoContent);

        // Verify entity is deleted by trying to get it
        var (getRsp, _) = await App.Client.GETAsync<{{entityName}}GetEndpoint, {{entityName}}GetRequest, {{entityName}}GetResponse>(
            new()
            {
                Id = createRes.Id
            });

        getRsp.StatusCode.Should().Be(HttpStatusCode.NotFound);
    }

    [Fact]
    public async Task Delete_NonExistent_{{entityName}}()
    {
        await SetAuthTokenAsync();
        
        var deleteRsp = await App.Client.DELETEAsync<{{entityName}}DeleteEndpoint, {{entityName}}DeleteRequest>(
            new()
            {
                Id = Guid.NewGuid()
            });

        deleteRsp.StatusCode.Should().Be(HttpStatusCode.NotFound);
    }
}